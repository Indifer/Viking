/** @license
 * viking <>
 * Author: indifer | MIT License
 * Email: indifer@126.com|liangyi_z@126.com
 * v0.2.0 (2017/07/19 16:44)
 */
;!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("crossroads")):"function"==typeof define&&define.amd?define("viking",["crossroads"],e):t.viking=e(t.crossroads)}(this,function(t){"use strict";function e(){return this.crossroads=t,this.currentRouteName="",this.currentRoute="",this.currentRefresh=!1,this.lastRoute="",this.lastRouteName="",this.routeType="action",this.controllers={},this.crossroads.bypassed.add(function(t){console.log(t)}),this}e.prototype.defineController=function(t,e){t=this.formatRouteName(t);var i=this,o=(e=e||{}).action,n=e.beforeAction,r=this.crossroads.addRoute(e.route,function(){if("action"===i.routeType){var r=t;i.currentRouteName=r,o.apply(e.action,arguments)}else"beforeAction"===i.routeType&&"function"==typeof n&&n.apply(e.beforeAction,arguments)});e.rules&&(r.rules=e.rules),r.existBeforeAction="function"==typeof e.beforeAction,r.reset=e.reset,r.resize=e.resize,r.destroy=e.destroy,r.init=e.init,r.module=e.module,this.controllers[t]=r},e.prototype.formatRouteName=function(t){return t.replace(/\//g,"-")},e.prototype.getRouteNameByRoute=function(t){t=t.indexOf("#")>-1?t.substr(1):t;for(var e in this.controllers)if(this.controllers[e].match(t))return this.formatRouteName(e);return""},e.prototype.getRouteByParameter=function(t,e){var i=this.controllers[t];return i?i.interpolate(e):""},e.prototype.onRouteChange=function(e){(e=e||!1)&&t.resetState();var i=this.currentRoute.indexOf("#")>-1?this.currentRoute.substr(1):this.currentRoute;t.parse(i)},e.prototype.gotoRoute=function(t,e){this.routeType="action",this.lastRoute=this.currentRoute,this.lastRouteName=this.currentRouteName;var i=t.toLowerCase();this.currentRoute=i,this.onRouteChange(e)},e.prototype.gotoRouteBefore=function(e){this.routeType="beforeAction";var i=e.toLowerCase();i=i.indexOf("#")>-1?i.substr(1):i,t.parse(i),t.resetState()},e.prototype.extend=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};var i=new e;return i.fn=e.prototype,i}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("viking")):"function"==typeof define&&define.amd?define("viking/util",["viking"],e):e(t.viking)}(this,function(t){"use strict";var e={isNullOrEmpty:function(t){return null===t||void 0===t||""===String.prototype.trim.call(t)},decodeUrlParams:function(t){t=t.split("&");var e,i={};for(var o in t)t.hasOwnProperty(o)&&2===(e=t[o].split("=")).length&&(i[e[0]]=e[1]);return i}};return t.util=e,t.util}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("viking"),require("viking/util")):"function"==typeof define&&define.amd?define("viking/history",["viking","viking/util"],e):e(t.viking,t["viking.util"])}(this,function(t,e){"use strict";function i(){return this._values=[],this}return i.prototype.clear=function(){this._values=[]},i.prototype.count=function(){return this._values.length},i.prototype.last=function(){return this._values.length>0?this._values[this._values.length-1]:null},i.prototype.pop=function(t){var e=[];for(t=t||1;t>0;)this._values.length>0&&e.push(this._values.pop()),t--;return e},i.prototype.add=function(t){return!e.isNullOrEmpty(t)&&(t=t.toString().toLowerCase().trim(),(0===this._values.length||this._values[this._values.length-1]!=t)&&(this._values.push(t),!0))},i.prototype.update=function(t,i){return!(e.isNullOrEmpty(t)||i<0)&&(t=t.toString().toLowerCase().trim(),this._values.length>i&&(this._values[i]=t,!0))},i.prototype.item=function(t){return t<0||t>this._values.length-1?null:this._values[t]},i.prototype.popTo=function(t){if(!e.isNullOrEmpty(t)){var i=this.count();if(i>0)for(var o=i-1;o>=0;o--)if(this.item(o).indexOf(t.toLowerCase())>-1){var n=i-o;return this.pop(n),n}return 0}},i.prototype.index=function(t){if(!e.isNullOrEmpty(t)){var i=this.count();if(i>0)for(var o=i-1;o>=0;o--)if(this.item(o).indexOf(t.toLowerCase())>-1)return i-o;return 0}},t.history=new i,t.history}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("viking"),require("ejs")):"function"==typeof define&&define.amd?define("viking/view",["viking","ejs"],e):e(t.viking,t.ejs)}(this,function(t,e){"use strict";return t.fn.view={},t.view.tempCached=!0,t.view.templates={},t.view.pages={},t.extend(t.fn.view,{define:function(e,i,o){e=t.formatRouteName(e),this.pages[e]={template:i,data:o}},getPage:function(t){var e=this.pages[t];return e?this.render({cache:!1,name:t},e.data):null},render:function(t,i){var o;return"string"==typeof t?o=t:t.name&&(o=this.pages[t.name].template),e.render(o,i)}}),t.view}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("viking"),require("viking/util"),require("viking/history"),require("viking/view")):"function"==typeof define&&define.amd?define("viking/app",["viking","viking/util","viking/history","viking/view"],e):e(t.viking,t["viking.util"],t["viking.history"],t["viking.view"])}(this,function(t,e,i,o){"use strict";function n(e,i,o,n,r){var s=t.app,u=t.getRouteNameByRoute(e),a=t.currentRouteName;if(s.initPage(u),t.controllers[u].isInit||(t.controllers[u].isInit=!0,"function"==typeof t.controllers[u].init&&t.controllers[u].init()),s.events.onBeforeGoto)for(var l=s.events.onBeforeGoto,f=0;f<l.length;f++)l[f](a,u);o&&"function"==typeof t.controllers[u].reset&&t.controllers[u].reset();t.controllers[u].existBeforeAction&&t.gotoRouteBefore(e.trim()),s.transitionsFlag=2,s.transitions(n,u,a,null,function(){""!==a&&"function"==typeof t.controllers[a].destroy&&(t.controllers[a].destroy(),t.controllers[u].isInit=!1),t.gotoRoute(e.trim()),s.transitionsFlag=0,"function"==typeof r&&r()})}t.fn.app={},t.app.transitionsFlag=0,window.addEventListener("popstate",function(){var t=window.history.state,e=t.toRoute.indexOf("#"),o=t.toRoute.indexOf("?"),r=t.toRoute.substring(e>-1?e+1:0,o>-1?o:t.toRoute.length-1);i.popTo(r);n(t.toRoute,0,!1)});return t.extend(t.fn.app,{events:{},addEvent:function(t,e){this.events[t]=this.events[t]||[],this.events[t].push(e)},beforeGoto:null,transitions:function(t,i,o,n,r){i="#"+i,o=e.isNullOrEmpty(o)?null:"#"+o;$(window).width(),$(window).height();switch(n=n||300,t){case"slideLeft":case"slideRight":case"fade":case"none":default:o&&$(o).css({left:0,top:0,opacity:1}),$(i).css({left:0,top:0,opacity:1});var s={};$(i).css(s),o&&($(o).css(s),$(o).hide()),$(i).show(),"function"==typeof r&&r()}},back:function(t,e){var o=this,n=i.last();o.goto(n,!0,t,e)},goto:function(o,r,s,u,a,l){var f=this;if(l=l||!1,!e.isNullOrEmpty(o)&&0==f.transitionsFlag){var p=t.getRouteNameByRoute(o);if(""!=p)if("block"!==$("#"+p).css("display")){if(s=null!=s&&"true"===s.toString(),!(r=null!=r&&"true"===r.toString())){var c={toRoute:o};t.currentRoute?(i.add(t.currentRoute),window.history.pushState(c,"",o)):window.history.replaceState(c,"",o)}if(r){var d=i.index(p);if(d>=0)return void window.history.go(-d-1)}n(o,0,s,u,a)}else f.transitionsFlag=0;else if(f.transitionsFlag=0,!l&&!e.isNullOrEmpty(o)){var h,v=o.indexOf("#");(v=(h=v>-1?o.substr(v+1):o).indexOf("?"))>-1&&(h=h.substr(0,v)),require([h],function(t){f.goto(o,r,s,u,a,!0)})}}},initPage:function(t){var e=this,i=$("#"+t);0==i.length&&o&&o.getPage&&(e.showLoading&&e.showLoading(),i=o.getPage(t),(i=$(i)).attr("id",t),i.attr("vk-role","page"),i.addClass("page"),i.css("display","none"),$("#vk-container").append(i),e.hideLoading&&e.hideLoading())},initApp:function(){if(0===$("#vk-outer").length){var t=$("div");t.attr("id","vk-outer");var e=$("div");e.attr("id","vk-container"),e.addClass("clearfixed"),t.append(e),$("body").children().remove(),$("body").append(t)}},ready:function(t){var i=this;i.initApp(),$("#vk-outer").on("click","[vk-goto]",function(){var t=$(this).attr("vk-goto"),o=$(this).attr("vk-transition"),n=$(this).attr("vk-reset"),r=$(this).attr("vk-back");return r=null!=r&&"true"===r.toString(),e.isNullOrEmpty(t)?r&&i.back(n,o):i.goto(t,r,n,o),!1})}}),t.app});;